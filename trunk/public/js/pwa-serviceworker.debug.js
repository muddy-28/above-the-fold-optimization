!function(p,k,v){function F(a,d,b){caches.open(q).then(function(c){function e(e){e=new Response(e,{status:d.status,statusText:d.statusText,headers:g});c.put(a,e)}var g={};d.headers.forEach(function(a,c){g[c]=a});g["x-abtf-sw"]=m();b&&b.max_age&&(g["x-abtf-sw-expire"]=b.max_age);d.headers.get("content-type").match(/text/i)?d.text().then(e):d.blob().then(e)})}function D(a){a&&("string"==typeof a&&(a=new Request(a,{mode:"no-cors"})),r(a).then(function(d){return d||(console.info("Abtf.sw() \u27a4 preload",
a.url),n(a,{conditions:null}))}))}function r(a){return caches.open(q).then(function(d){return d.match(a)})}function x(a,d){return a=new Request(a),r(a).then(function(a){return a?a.text().then(function(c){return new Response(c,{status:503,statusText:"Offline",headers:a.headers})}):k(d)["catch"](function(a){throw a;})})}function G(a,d,b,c){var e=b.headers.get("etag"),g=b.headers.get("last-modified");e||g?(b=new Request(a.url,{method:"HEAD",headers:a.headers,mode:"no-cors"}),k(b).then(function(b){var l=
!1,f=b.headers.get("etag");b=b.headers.get("last-modified");return(f&&f!==e?l=!0:b&&b!==g&&(l=!0),l)?(console.info("Abtf.sw() \u27a4 HEAD \u27a4 update",a.url),l=n(a,d),c&&(l=l.then(c)),l):null})["catch"](function(){var e=n(a,d);return c&&(e=e.then(c)),e})):(console.warn("Abtf.sw() \u27a4 HEAD \u27a4 no etag or last-modified",a.url),b=n(a,d),c&&(b=b.then(c)))}function n(a,d,b){return k(a).then(function(c){if(c.ok&&400>c.status&&d){var e=!0;d.conditions&&(d.conditions.forEach(function(b){if(e)switch(b.type){case "url":b.regex?
(g=w(b.pattern))?(f=g.test(a.url),b.not?f&&(e=!1):f||(e=!1)):e=!1:(f=-1!==a.url.indexOf(b.pattern),b.not?f&&(e=!1):f||(e=!1));break;case "header":var d=c.headers.get(b.name);if(d)if(b.regex){var g=w(b.pattern);g?(f=g.test(d),b.not?f&&(e=!1):f||(e=!1)):e=!1}else if("object"==typeof b.pattern)if(b.pattern.operator)if(d=parseFloat(d),g=parseFloat(b.pattern.value),isNaN(d)||isNaN(g))e=!1;else{switch(b.pattern.operator){case "<":f=d<g;break;case ">":f=d>g;break;case "=":var f=d===g;break;default:e=!1}e&&
(b.not?f&&(e=!1):f||(e=!1))}else e=!1;else-1===d.indexOf(b.pattern)&&(e=!1);else e=!1}}),e?console.info("Abtf.sw() \u27a4 cache condition \u27a4 cache",a.url,d.conditions):console.info("Abtf.sw() \u27a4 cache condition \u27a4 no cache",a.url,d.conditions));e&&F(a,c.clone(),d)}return c})["catch"](function(c){return b?b(a,null,c):null})}function E(){y||(!z||z<m()-10)&&(y=!0,z=m(),caches.keys().then(function(a){return a&&0!==a.length?Promise.all(a.map(function(a){if(0!==a.indexOf(q))return console.info("Abtf.sw() \u27a4 old cache deleted",
a),caches["delete"](a);caches.open(a).then(function(b){b.keys().then(function(c){if(console.info("Abtf.sw() \u27a4 prune cache",a,"size:",c.length,t),c.length<t)return this;var e=[],g=[],d=[];return c.forEach(function(a){g.push(a);d.push(b.match(a))}),Promise.all(d).then(function(a){var c=m();return a.forEach(function(a,d){if(a&&a.headers){var f=a.headers.get("x-abtf-sw");if(f){var l=a.headers.get("x-abtf-sw-expire");if(l&&f&&f<m()-l)return console.info("Abtf.sw() \u27a4 cache \u27a4 expired",a.url),
void b["delete"](g[d])}else f=c;!1!==e&&e.push({t:f,r:g[d]})}}),e&&e.length>t&&(e.sort(function(a,b){return a.t>b.t?-1:a.t<b.t?1:0}),e.slice(t).forEach(function(a){b["delete"](a.r)})),this})})})})).then(function(){y=!1}):Promise.resolve()}))}function w(a){if(a=a.match(H)){try{var d=new RegExp(a[1],a[2])}catch(b){}return d||!1}}function m(){return Math.round(Date.now()/1E3)}function A(){return k("./abtf-pwa-policy.json",{mode:"no-cors"}).then(function(a){if(a&&a.ok&&400>a.status)return a.json().then(function(a){if(console.info("Abtf.sw() \u27a4 policy "+
(h?"updated":"loaded"),a),h=a,u=m(),h&&0<h.length){var b=[];h.forEach(function(a){a.offline&&-1===b.indexOf(a.offline)&&b.push(a.offline)});b.forEach(function(a){D(a)})}});throw h=!1,Error("cache policy not found: ./abtf-pwa-policy.json");})["catch"](function(a){throw h=!1,a;})}function B(a){return new Promise(function(d,b){if(h&&d(h),!h||!u||a&&a>u){var c=!h;A().then(function(){c&&(h?d(h):b())})["catch"](function(){c&&b()})}else if(u<m()-300){var e=new Request("./abtf-pwa-policy.json",{method:"HEAD",
mode:"no-cors"});k(e).then(function(a){a=a.headers.get("last-modified");(!a||a&&a>u)&&A()})}})}var q,h=!1,u=!1,t=1E3;v.prototype.add||(v.prototype.add=function(a){return this.addAll([a])});v.prototype.addAll||(v.prototype.addAll=function(a){function d(a){this.name="NetworkError";this.code=19;this.message=a}var b=this;return d.prototype=Object.create(Error.prototype),Promise.resolve().then(function(){if(1>arguments.length)throw new TypeError;return a=a.map(function(a){return a instanceof Request?a:
String(a)}),Promise.all(a.map(function(a){"string"==typeof a&&(a=new Request(a));var b=(new URL(a.url)).protocol;if("http:"!==b&&"https:"!==b)throw new d("Invalid scheme");return k(a.clone())["catch"](function(a){throw a;})}))}).then(function(c){return Promise.all(c.map(function(e,c){return b.put(a[c],e)}))}).then(function(){})});CacheStorage.prototype.match||(CacheStorage.prototype.match=function(a,d){var b=this;return this.keys().then(function(c){var e;return c.reduce(function(c,h){return c.then(function(){return e||
b.open(h).then(function(b){return b.match(a,d)}).then(function(a){return e=a})})},Promise.resolve())})});p.addEventListener("install",function(a){a.waitUntil(A().then(function(){p.skipWaiting()})["catch"](function(){p.skipWaiting()}))});p.addEventListener("activate",function(a){a.waitUntil(p.clients.claim())});var C,H=/^\/(.*)\/([gimuy]+)?$/,z=!1,y=!1;p.addEventListener("fetch",function(a){if("GET"===a.request.method&&!(a.request.url.match(/wp-admin/)||a.request.url.match(/preview=true/)||a.request.url.match(/\/wp-login\./))){if(h&&
q)return a.respondWith(B().then(function(d){if(!d||0===d.length)return k(a.request)["catch"](function(a){throw a;});if(C)try{clearTimeout(C)}catch(c){}C=setTimeout(E,500);var b=!1;if(d.forEach(function(c){if(!b&&c.match&&0!==c.match.length){var e=!0;c.match.forEach(function(b){if(e)switch(b.type){case "url":if(b.regex)(d=w(b.pattern))?(f=d.test(a.request.url),b.not?f&&(e=!1):f||(e=!1)):e=!1;else if(b.pattern instanceof Array){var c=!1;b.pattern.forEach(function(b){c||-1!==a.request.url.indexOf(b)&&
(c=!0)});b.not?c&&(e=!1):c||(e=!1)}else f=-1!==a.request.url.indexOf(b.pattern),b.not?f&&(e=!1):f||(e=!1);break;case "header":if(f=a.request.headers.get(b.name))if(b.regex){var d=w(b.pattern);d?(f=d.test(f),b.not?f&&(e=!1):f||(e=!1)):e=!1}else{var f=-1!==f.indexOf(b.pattern);b.not?f&&(e=!1):f||(e=!1)}else b.not||(e=!1)}});e&&(b=c)}}),!b)return console.info("Abtf.sw() \u27a4 policy \u27a4 no match",a.request.url),k(a.request)["catch"](function(a){throw a;});switch(console.info("Abtf.sw() \u27a4 policy \u27a4 match",
a.request.url,b),b.strategy){case "cache":return r(a.request).then(function(c){if(c&&b.cache.max_age&&c.headers.get("x-abtf-sw")<m()-b.cache.max_age&&(c=!1),c){var e=!0,d=b.cache.update_interval?!isNaN(parseInt(b.cache.update_interval))&&parseInt(b.cache.update_interval):!1;if(d){var h=c.headers.get("x-abtf-sw");h&&parseInt(h)>m()-d&&(e=!1)}return e&&function(a,e){setTimeout(function(){var c;if(b.cache.head_update&&(c=function(){clients.matchAll().then(function(b){b.forEach(function(b){b.postMessage([2,
a.url])})})}),b.cache.head_update)console.info("Abtf.sw() \u27a4 HEAD \u27a4 verify",a.url),G(a,b.cache,e,c);else{console.info("Abtf.sw() \u27a4 update cache",a.url);var d=n(a,b.cache);c&&d.then(c)}},10)}(a.request.clone(),c.clone()),console.info("Abtf.sw() \u27a4 from cache",a.request.url),c}return n(a.request,b.cache,function(c,e,d){return b.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 offline page",c.url),x(b.offline,c.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 empty 404 response",
c.url,e,d),e||k(a.request.clone())["catch"](function(a){throw a;}))})});case "event":return r(a.request).then(function(c){return c&&b.cache.max_age&&c.headers.get("x-abtf-sw")<m()-b.cache.max_age&&(c=!1),c?(console.info("Abtf.sw() \u27a4 from cache",a.request.url),c):n(a.request,null,function(c,d){return b.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 offline page",c.url),x(b.offline,c.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 empty 404 response",
c.url,d),d||k(a.request)["catch"](function(a){throw a;}))})});default:return n(a.request,b.cache,function(c,e,d){return console.warn("Abtf.sw() \u27a4 network failed",c.url,e||d),r(c).then(function(d){return d?(console.info("Abtf.sw() \u27a4 fallback from cache",c.url),d):b.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 offline page",c.url),x(b.offline,c.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 empty 404 response",c.url),e||k(a.request)["catch"](function(a){throw a;}))})})}}));
B()}});p.addEventListener("message",function(a){if(a&&a.data&&a.data instanceof Array){if(1===a.data[0]){a.data[1]&&!isNaN(parseInt(a.data[1]))&&B(parseInt(a.data[1]));a.data[3]&&!isNaN(parseInt(a.data[3]))&&(t=parseInt(a.data[3]));var d="abtf:"+(a.data[2]?a.data[2]+":":"");d!==q&&(q=d,console.info("Abtf.sw() \u27a4 cache prefix changed",q));E()}if(2===a.data[0]&&a.data[1]){var b;"string"==typeof a.data[1]||a.data[1]instanceof Request?b=[a.data[1]]:a.data[1]instanceof Array&&(b=a.data[1]);b&&b.forEach(function(a){D(a)})}}})}(self,
self.fetch,Cache);
