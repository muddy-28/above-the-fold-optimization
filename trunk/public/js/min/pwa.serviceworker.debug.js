!function(e,t,n){var r,o=!1,a=!1,c=1e3;n.prototype.add||(n.prototype.add=function(e){return this.addAll([e])}),n.prototype.addAll||(n.prototype.addAll=function(e){function n(e){this.name="NetworkError",this.code=19,this.message=e}var r=this;return n.prototype=Object.create(Error.prototype),Promise.resolve().then(function(){if(arguments.length<1)throw new TypeError;return e=e.map(function(e){return e instanceof Request?e:String(e)}),Promise.all(e.map(function(e){"string"==typeof e&&(e=new Request(e));var r=new URL(e.url).protocol;if("http:"!==r&&"https:"!==r)throw new n("Invalid scheme");return t(e.clone()).catch(function(e){throw e})}))}).then(function(t){return Promise.all(t.map(function(t,n){return r.put(e[n],t)}))}).then(function(){})}),CacheStorage.prototype.match||(CacheStorage.prototype.match=function(e,t){var n=this;return this.keys().then(function(r){var o;return r.reduce(function(r,a){return r.then(function(){return o||n.open(a).then(function(n){return n.match(e,t)}).then(function(e){return o=e})})},Promise.resolve())})}),e.addEventListener("install",function(t){t.waitUntil(s().then(function(){e.skipWaiting()}).catch(function(){e.skipWaiting()}))}),e.addEventListener("activate",function(t){t.waitUntil(e.clients.claim())});var i,f=function(e){return new Promise(function(n,r){if(o&&n(o),!o||!a||e&&e>a){var c=!o;s().then(function(){c&&(o?n(o):r())}).catch(function(){c&&r()})}else if(a<u()-300){var i=new Request("./abtf-pwa-config.json",{method:"HEAD",mode:"no-cors"});t(i).then(function(e){var t=!0;if(e&&e.ok){var n=e.headers.get("last-modified");n&&n<=a&&(t=!1)}t&&s()}).catch(function(e){s()})}}).catch(function(e){throw e})},s=function(){return t("./abtf-pwa-config.json",{mode:"no-cors"}).then(function(e){if(e&&e.ok&&e.status<400)return e.json().then(function(e){if(console.info("Abtf.sw() ➤ config "+(o?"updated":"loaded"),e),e){e instanceof Array&&(e={policy:e}),e.policy&&(o=e.policy,a=u());var t=[];e.policy&&e.policy.forEach(function(e){e.offline&&-1===t.indexOf(e.offline)&&t.push(e.offline)}),e.preload&&e.preload.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),t.forEach(function(e){A(e)})}});throw o=!1,new Error("service worker config not found: ./abtf-pwa-config.json")}).catch(function(e){throw o=!1,e})},u=function(){return Math.round(Date.now()/1e3)},h=/^\/(.*)\/([gimuy]+)?$/,l=function(e){var t=e.match(h);if(t){try{var n=new RegExp(t[1],t[2])}catch(e){}return n||!1}},d=!1,p=!1,w=function(){if(i)try{clearTimeout(i)}catch(e){}i=setTimeout(v,500)},v=function(){p||(!d||d<u()-10)&&(p=!0,d=u(),caches.keys().then(function(e){return e&&0!==e.length?Promise.all(e.map(function(e){if(0!==e.indexOf(r))return console.info("Abtf.sw() ➤ old cache deleted",e),caches.delete(e);caches.open(e).then(function(t){t.keys().then(function(n){if(console.info("Abtf.sw() ➤ prune cache",e,"size:",n.length,c),!(n.length<c)){var r=[],o=[],a=[];return n.forEach(function(e){o.push(e),a.push(t.match(e))}),Promise.all(a).then(function(e){var n=u();e.forEach(function(e,a){if(e&&e.headers){var c=e.headers.get("x-abtf-sw");if(c){var i=e.headers.get("x-abtf-sw-expire");if(i&&c&&c<u()-i)return console.info("Abtf.sw() ➤ cache ➤ expired",e.url),void t.delete(o[a])}else c=n;!1!==r&&r.push({t:c,r:o[a]})}}),r&&r.length>c&&(r.sort(function(e,t){return e.t>t.t?-1:e.t<t.t?1:0}),r.slice(c).forEach(function(e){t.delete(e.r)}))})}})})})).then(function(){p=!1}):Promise.resolve()}))},m=function(e,n,r){return t(e).then(function(t){if(t.ok&&t.status<400&&n){var r=!0;n.conditions&&(n.conditions.forEach(function(n){if(r)switch(n.type){case"url":if(n.regex)if(a=l(n.pattern)){i=a.test(e.url);n.not?i&&(r=!1):i||(r=!1)}else r=!1;else{i=-1!==e.url.indexOf(n.pattern);n.not?i&&(r=!1):i||(r=!1)}break;case"header":var o=t.headers.get(n.name);if(o)if(n.regex){var a=l(n.pattern);if(a){i=a.test(o);n.not?i&&(r=!1):i||(r=!1)}else r=!1}else if("object"==typeof n.pattern)if(n.pattern.operator){o=parseFloat(o);var c=parseFloat(n.pattern.value);if(isNaN(o)||isNaN(c))r=!1;else{switch(n.pattern.operator){case"<":i=o<c;break;case">":i=o>c;break;case"=":var i=o===c;break;default:r=!1}r&&(n.not?i&&(r=!1):i||(r=!1))}}else r=!1;else-1===o.indexOf(n.pattern)&&(r=!1);else r=!1}}),r?console.info("Abtf.sw() ➤ cache condition ➤ cache",e.url,n.conditions):console.info("Abtf.sw() ➤ cache condition ➤ no cache",e.url,n.conditions)),r&&x(e,t.clone(),n)}return t}).catch(function(t){return r?r(e,null,t):null})},g=function(e,n,r,o){var a=r.headers.get("etag"),c=r.headers.get("last-modified");if(!a&&!c){console.warn("Abtf.sw() ➤ HEAD ➤ no etag or last-modified",e.url);var i=m(e,n);return o&&(i=i.then(o)),i}var f=new Request(e.url,{method:"HEAD",headers:e.headers,mode:"no-cors"});t(f).then(function(t){var r=!1,i=t.headers.get("etag"),f=t.headers.get("last-modified");if(i&&i!==a?r=!0:f&&f!==c&&(r=!0),r){console.info("Abtf.sw() ➤ HEAD ➤ update",e.url);var s=m(e,n);return o&&(s=s.then(o)),s}return null}).catch(function(t){var r=m(e,n);return o&&(r=r.then(o)),r})},b=function(e,n){return e=new Request(e),y(e).then(function(e){return e?e.blob().then(function(t){return new Response(t,{status:503,statusText:"Offline",headers:e.headers})}):t(n).catch(function(e){throw e})})},y=function(e){return caches.open(r).then(function(t){return t.match(e)})},A=function(e){if(e)return"string"==typeof e&&(e=new Request(e,{mode:"no-cors"})),y(e).then(function(t){return t||(console.info("Abtf.sw() ➤ preload",e.url),m(e,{conditions:null}))})},x=function(e,t,n){caches.open(r).then(function(r){var o={};t.headers.forEach(function(e,t){o[t]=e}),o["x-abtf-sw"]=u(),n&&n.max_age&&(o["x-abtf-sw-expire"]=n.max_age),t.blob().then(function(n){var a=new Response(n,{status:t.status,statusText:t.statusText,headers:o});r.put(e,a)})})};e.addEventListener("fetch",function(n){if("GET"===n.request.method){var a=!1;if(["wp-admin/","wp-login."].forEach(function(t){if(!a){var r=new RegExp("^([^/]+)?//"+e.location.host+"(:[0-9]+)?/"+t);(r.test(n.request.url)||n.request.referrer&&r.test(n.request.referrer))&&(a=!0)}}),!(a||n.request.url.match(/\&preview=true/)||n.request.url.match(/\&preview_nonce=/))){if(o&&r)return n.respondWith(f().then(function(e){if(!e||0===e.length)return t(n.request).catch(function(e){throw e});w();var r=!1;if(e.forEach(function(e){if(!r&&e.match&&0!==e.match.length){var t=!0;e.match.forEach(function(e){if(t)switch(e.type){case"url":if(e.regex)if(a=l(e.pattern)){c=a.test(n.request.url);e.not?c&&(t=!1):c||(t=!1)}else t=!1;else if(e.pattern instanceof Array){var r=!1;e.pattern.forEach(function(e){r||-1!==n.request.url.indexOf(e)&&(r=!0)}),e.not?r&&(t=!1):r||(t=!1)}else{c=-1!==n.request.url.indexOf(e.pattern);e.not?c&&(t=!1):c||(t=!1)}break;case"header":switch(e.name.toLowerCase()){case"referer":case"referrer":o=n.request.referrer;break;default:var o=n.request.headers.get(e.name)}if(o)if(e.regex){var a=l(e.pattern);if(a){c=a.test(o);e.not?c&&(t=!1):c||(t=!1)}else t=!1}else{var c=-1!==o.indexOf(e.pattern);e.not?c&&(t=!1):c||(t=!1)}else e.not||(t=!1)}}),t&&(r=e)}}),!r)return console.info("Abtf.sw() ➤ policy ➤ no match",n.request.url),t(n.request).catch(function(e){throw e});switch(console.info("Abtf.sw() ➤ policy ➤ match",n.request.url,r),r.strategy){case"cache":return y(n.request).then(function(e){if(e&&r.cache.max_age&&e.headers.get("x-abtf-sw")<u()-r.cache.max_age&&(e=!1),e){var o=!0;if(r.cache.update_interval)a=!isNaN(parseInt(r.cache.update_interval))&&parseInt(r.cache.update_interval);else var a=!1;if(a){var c=e.headers.get("x-abtf-sw");c&&parseInt(c)>u()-a&&(o=!1)}return o&&function(e,t){setTimeout(function(){var n;if(r.cache.head_update&&(n=function(){clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage([2,e.url])})})}),r.cache.head_update)console.info("Abtf.sw() ➤ HEAD ➤ verify",e.url),g(e,r.cache,t,n);else{console.info("Abtf.sw() ➤ update cache",e.url);var o=m(e,r.cache);n&&o.then(n)}},10)}(n.request.clone(),e.clone()),console.info("Abtf.sw() ➤ from cache",n.request.url),e}return m(n.request,r.cache,function(e,o,a){return r.offline?(console.warn("Abtf.sw() ➤ no cache ➤ network failed ➤ offline page",e.url),b(r.offline,e.clone())):(console.warn("Abtf.sw() ➤ no cache ➤ network failed ➤ empty 404 response",e.url,o,a),o||t(n.request.clone()).catch(function(e){throw e}))})});case"event":return y(n.request).then(function(e){return e&&r.cache.max_age&&e.headers.get("x-abtf-sw")<u()-r.cache.max_age&&(e=!1),e?(console.info("Abtf.sw() ➤ from cache",n.request.url),e):m(n.request,null,function(e,o,a){return r.offline?(console.warn("Abtf.sw() ➤ no cache ➤ network failed ➤ offline page",e.url),b(r.offline,e.clone())):(console.warn("Abtf.sw() ➤ no cache ➤ network failed ➤ empty 404 response",e.url,o),o||t(n.request).catch(function(e){throw e}))})});case"network":default:return m(n.request,r.cache,function(e,o,a){return console.warn("Abtf.sw() ➤ network failed",e.url,o||a),y(e).then(function(a){return a?(console.info("Abtf.sw() ➤ fallback from cache",e.url),a):r.offline?(console.warn("Abtf.sw() ➤ no cache ➤ offline page",e.url),b(r.offline,e.clone())):(console.warn("Abtf.sw() ➤ no cache ➤ empty 404 response",e.url),o||t(n.request).catch(function(e){throw e}))})})}}));f()}}}),e.addEventListener("message",function(e){if(e&&e.data&&e.data instanceof Array){if(1===e.data[0]){e.data[1]&&!isNaN(parseInt(e.data[1]))&&f(parseInt(e.data[1])),e.data[3]&&!isNaN(parseInt(e.data[3]))&&(c=parseInt(e.data[3]));var t="abtf:"+(e.data[2]?e.data[2]+":":"");t!==r&&(r=t,console.info("Abtf.sw() ➤ cache prefix changed",r)),v()}if(2===e.data[0]&&e.data[1]){var n;"string"==typeof e.data[1]||e.data[1]instanceof Request?n=[e.data[1]]:e.data[1]instanceof Array&&(n=e.data[1]),n&&n.forEach(function(e){A(e)})}}})}(self,self.fetch,Cache);