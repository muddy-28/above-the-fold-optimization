!function(e){var r,o,t=!1,n=!1,f=!1,i=!1,l=!1,c=!1,a=!1,s=!1,u=[],p=[],h=[],d={},g=[];e[23]=function(e){if(void 0===b)var b=!1;if((r=e[0]||b)||console.error("Abtf.proxy()","no proxy url",e),t=e[1]||!1,n=e[2]||!1,(f=e[9]||!1)&&g.push(f),i=e[5]||!1,l=e[6]||!1,c=e[7]||!1,a=e[8]||!1,e[3]){s=!0;for(x=0;x<e[3].length;x++)"regex"===e[3][x][0]?(h.push([e[3][x][2],e[3][x][3],e[3][x][1]]),e[3][x][4]&&(d[e[3][x][0]]=e[3][x][4],-1===g.indexOf(e[3][x][4])&&g.push(e[3][x][4]))):(u.push(e[3][x][0]),p.push(e[3][x][1]),e[3][x][4]&&(d[e[3][x][0]]=e[3][x][4],-1===g.indexOf(e[3][x][4])&&g.push(e[3][x][4])));o=e[4]||!1}if(0===g.length)g=!1;else for(var v=g.length,x=0;x<v;x++)g[x]=A(g[x])};var b={Element:"undefined"!=typeof Element&&Element,Document:"undefined"!=typeof Document&&Document},v={append:{},insert:{}};for(var x in b)b.hasOwnProperty(x)&&b[x]&&(v.append[x]=b[x].prototype.appendChild,v.insert[x]=b[x].prototype.insertBefore);var y=document.createElement("a");y.href=document.location.href;var A=function(e){var r=document.createElement("a");return r.href=e,r},O=function(e,o){return"css"===o?r.replace("{PROXY:URL}",escape(e)).replace("{PROXY:TYPE}",escape(o)):"js"===o?r.replace("{PROXY:URL}",escape(e)).replace("{PROXY:TYPE}",escape(o)):void 0},m=function(r,t){var n,f=!1;if(s){var i=u.indexOf(r);if(i>-1)var l=p[i];else if(h.length>0)for(var c,a,g=h.length,b=0;b<g;b++){a=!1;try{c=new RegExp(h[b][0],h[b][1]||"")}catch(e){a=!0}if(!a&&c.test(r)){f=!0,n=r,h[b][2]?l=h[b][2]:h[b][3]&&(r=h[b][3]);break}}if(l){if(void 0!==d[r])v=d[r];else var v=o;v+=l.substr(0,2)+"/",v+=l.substr(2,2)+"/",v+=l.substr(4,2)+"/",v+=l;var x=!1;if("js"===t){if(v+=".js",void 0!==e[20]){var y=A(v).href;(v=e[20](y))!==y&&(x=v)}}else"css"===t&&(v+=".css");return x?f?console.log("Abtf.proxy()","localStorage regex capture",e[25](n),"➤","cache:"+l,"➤",x):console.log("Abtf.proxy()","localStorage capture",e[25](r),"➤","cache:"+l,"➤",x):f?console.log("Abtf.proxy()","regex capture",e[25](n),"➤","cache:"+l):console.log("Abtf.proxy()","capture",e[25](r),"➤","cache:"+l),v}}if("js"===t&&void 0!==e[20]){var m=A(r).href;if((r=e[20](m))!==m)return f?console.log("Abtf.proxy()","localStorage regex capture",e[25](n),"regex","➤",e[25](m),"➤",r):console.log("Abtf.proxy()","localStorage capture",e[25](m),"➤",r),r}return f?console.log("Abtf.proxy()","capture",e[25](n),"regex","➤",r):console.log("Abtf.proxy()","capture",e[25](r)),O(r,t)},j=function(e,r){var o="object"==typeof e&&void 0!==e.href?e:A(e);if("blob:"===o.protocol)return!1;if(g&&!0!==r)for(var t=g.length,n=0;n<t;n++)if(-1!==o.href.indexOf(g[n].href))return!1;return o.host!==y.host},P=function(r){var o="object"==typeof r&&void 0!==r.href?r:A(r);if("blob:"===o.protocol)return!0;if(i){for(var t=!1,n=i.length,f=0;f<n;f++)if(-1!==o.href.indexOf(i[f])){t=!0;break}if(!t)return console.log("Abtf.proxy()","ignore",e[25](o.href),"not on include list"),!0}if(l)for(var n=l.length,f=0;f<n;f++)if(-1!==o.href.indexOf(l[f]))return console.log("Abtf.proxy()","ignore",e[25](o.href),"on exclude list:",l[f]),!0;return!1},C=function(e){var r="object"==typeof e&&void 0!==e.href?e:A(e);if("blob:"===r.protocol)return!1;if(g)for(var o=g.length,t=0;t<o;t++)if(-1!==r.href.indexOf(g[t].href))return!1;return r.host!==y.host},E=function(r){var o="object"==typeof r&&void 0!==r.href?r:A(r);if("blob:"===o.protocol)return!0;if(c){for(var t=!1,n=c.length,f=0;f<n;f++)if(-1!==o.href.indexOf(c[f])){t=!0;break}if(!t)return console.log("Abtf.proxy()","ignore",e[25](o.href),"not on include list"),!0}if(a)for(var n=a.length,f=0;f<n;f++)if(-1!==o.href.indexOf(a[f]))return console.log("Abtf.proxy()","ignore",e[25](o.href),"on exclude list:",a[f]),!0;return!1},R=function(r){if(r.nodeName)if("SCRIPT"===r.nodeName.toUpperCase()){if(!t)return!1;if(r.hasAttribute("data-abtf"))return!1;if(r.src){o=A(r.src);if(P(o))return!1;if(!j(o)){if(void 0!==e[20]){if("blob:"===o.protocol)return!1;url=e[20](o.href),url!==o.href?(console.log("Abtf.proxy()","localStorage local capture",e[25](o.href),"➤",url),r.src=url):console.log("Abtf.proxy()","localStorage local capture",e[25](o.href),"➤","bypass cache","➤",url)}return!1}return"js"}}else if("LINK"===r.nodeName.toUpperCase()&&"stylesheet"===r.rel.toLowerCase()){if(!n)return!1;if(r.hasAttribute("data-abtf"))return!1;if(r.href){var o=A(r.href);return!E(o)&&(!!C(o)&&"css")}}return!1},S=function(e){var r=R(e);if(!r)return!1;var o=A("css"===r?e.href:e.src).href,t=m(o,r);"css"===r?e.href=t:"js"===r&&(e.src=t)},w={appendChild:function(e,r){return S(r),v.append[e].call(this,r)},insertBefore:function(e,r,o){return S(r),v.insert[e].call(this,r,o)}};for(var x in b)b.hasOwnProperty(x)&&b[x]&&function(e){b[e].prototype.appendChild=function(r){return w.appendChild.call(this,e,r)},b[e].prototype.insertBefore=function(r,o){return w.insertBefore.call(this,e,r,o)}}(x);e[24]=function(e){return j(e,!0)?O(e,"js"):e}}(window.Abtf);