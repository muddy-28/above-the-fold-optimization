!function(n,m,w){function I(a,c,f){caches.open(t).then(function(b){var e={};c.headers.forEach(function(a,b){e[b]=a});e["x-abtf-sw"]=k();f&&f.max_age&&(e["x-abtf-sw-expire"]=f.max_age);c.blob().then(function(d){d=new Response(d,{status:c.status,statusText:c.statusText,headers:e});b.put(a,d)})})}function F(a){if(a)return"string"==typeof a&&(a=new Request(a,{mode:"no-cors"})),u(a).then(function(c){return c||q(a,{conditions:null})})}function u(a){return caches.open(t).then(function(c){return c.match(a).then(function(a){if(a){var b=
a.headers.get("x-abtf-sw-expire");if(b)var e=a.headers.get("x-abtf-sw");var d=a.headers.get("expire");d&&(d=x(d));b&&e<k()-b?a=!1:d&&d<k()&&(a=!1)}return a})})}function B(a,c){return a=new Request(a),u(a).then(function(a){return a?a.blob().then(function(b){return new Response(b,{status:503,statusText:"Offline",headers:a.headers})}):m(c)["catch"](function(a){throw a;})})}function J(a,c,f,b){var e=f.headers.get("etag"),d=x(f.headers.get("last-modified"));e||d?(f=new Request(a.url,{method:"HEAD",headers:a.headers,
mode:"no-cors"}),m(f).then(function(p){var g=!1,h=p.headers.get("etag");p=x(p.headers.get("last-modified"));return(h&&h!==e?g=!0:p&&p!==d&&(g=!0),g)?(g=q(a,c),b&&(g=g.then(b)),g):null})["catch"](function(){var d=q(a,c);return b&&(d=d.then(b)),d})):(f=q(a,c),b&&(f=f.then(b)))}function q(a,c,f){return m(a).then(function(b){if(b.ok&&400>b.status&&c){var e=!0;c.conditions&&c.conditions.forEach(function(d){if(e)switch(d.type){case "url":d.regex?(g=y(d.pattern))?(h=g.test(a.url),d.not?h&&(e=!1):h||(e=!1)):
e=!1:(h=-1!==a.url.indexOf(d.pattern),d.not?h&&(e=!1):h||(e=!1));break;case "header":var c=b.headers.get(d.name);if(c)if(d.regex){var g=y(d.pattern);g?(h=g.test(c),d.not?h&&(e=!1):h||(e=!1)):e=!1}else if("object"==typeof d.pattern)if(d.pattern.operator)if(c=parseFloat(c),g=parseFloat(d.pattern.value),isNaN(c)||isNaN(g))e=!1;else{switch(d.pattern.operator){case "<":h=c<g;break;case ">":h=c>g;break;case "=":var h=c===g;break;default:e=!1}e&&(d.not?h&&(e=!1):h||(e=!1))}else e=!1;else-1===c.indexOf(d.pattern)&&
(e=!1);else e=!1}});e&&I(a,b.clone(),c)}return b})["catch"](function(b){return f?f(a,null,b):null})}function G(){C||(!D||D<k()-10)&&(C=!0,D=k(),caches.keys().then(function(a){return a&&0!==a.length?Promise.all(a.map(function(a){if(0!==a.indexOf(t))return caches["delete"](a);caches.open(a).then(function(a){a.keys().then(function(b){if(!(b.length<z)){var c=[],d=[],f=[];return b.forEach(function(b){d.push(b);f.push(a.match(b))}),Promise.all(f).then(function(b){var g=k();b.forEach(function(b,e){if(b&&
b.headers){var h=b.headers.get("x-abtf-sw");if(h){var f=b.headers.get("x-abtf-sw-expire");if(f&&h&&h<k()-f)return void a["delete"](d[e])}else h=g;!1!==c&&c.push({t:h,r:d[e]})}});c&&c.length>z&&(c.sort(function(a,b){return a.t>b.t?-1:a.t<b.t?1:0}),c.slice(z).forEach(function(b){a["delete"](b.r)}))})}})})})).then(function(){C=!1}):Promise.resolve()}))}function y(a){if(a=a.match(K)){try{var c=new RegExp(a[1],a[2])}catch(f){}return c||!1}}function x(a){if(a)return isNaN(parseInt(a))?(a=Date.parse(a),
isNaN(a)?void 0:Math.round(a/1E3)):a}function k(){return Math.round(Date.now()/1E3)}function A(){return r?Promise.resolve():(r=!0,m("./abtf-pwa-config.json?"+Math.round(Date.now()/1E3),{mode:"no-cors"}).then(function(a){if(r=!1,a&&a.ok&&400>a.status)return a.json().then(function(a){if(a){a instanceof Array&&(a={policy:a});a.policy&&(l=a.policy,v=k());var c=[];a.policy&&a.policy.forEach(function(a){a.offline&&-1===c.indexOf(a.offline)&&c.push(a.offline)});a.preload&&a.preload.forEach(function(a){-1===
c.indexOf(a)&&c.push(a)});c.forEach(function(a){F(a)})}});throw l=!1,Error("service worker config not found: ./abtf-pwa-config.json");})["catch"](function(a){l=r=!1;setTimeout(function(){throw a;})}))}function H(a){(new Promise(function(c){if(!l||!v||a&&a>v){var f=!l;A().then(function(){f&&c(l?l:!1)})["catch"](function(){f&&c(!1)})}else if(!r&&v<k()-300){r=!0;var b=new Request("./abtf-pwa-config.json?"+Math.round(Date.now()/1E3),{method:"HEAD",mode:"no-cors"});m(b).then(function(a){r=!1;var b=!0;
a&&a.ok&&(a=x(a.headers.get("last-modified")))&&a<=v&&(b=!1);b&&A()})["catch"](function(){r=!1;A()})}else c(l)}))["catch"](function(a){setTimeout(function(){throw a;})})}var t,l=!1,v=!1,z=1E3;w.prototype.add||(w.prototype.add=function(a){return this.addAll([a])});w.prototype.addAll||(w.prototype.addAll=function(a){function c(a){this.name="NetworkError";this.code=19;this.message=a}var f=this;return c.prototype=Object.create(Error.prototype),Promise.resolve().then(function(){if(1>arguments.length)throw new TypeError;
return a=a.map(function(a){return a instanceof Request?a:String(a)}),Promise.all(a.map(function(a){"string"==typeof a&&(a=new Request(a));var b=(new URL(a.url)).protocol;if("http:"!==b&&"https:"!==b)throw new c("Invalid scheme");return m(a.clone())["catch"](function(a){throw a;})}))}).then(function(b){return Promise.all(b.map(function(b,d){return f.put(a[d],b)}))}).then(function(){})});CacheStorage.prototype.match||(CacheStorage.prototype.match=function(a,c){var f=this;return this.keys().then(function(b){var e;
return b.reduce(function(b,p){return b.then(function(){return e||f.open(p).then(function(b){return b.match(a,c)}).then(function(a){return e=a})})},Promise.resolve())})});n.addEventListener("install",function(a){a.waitUntil(A().then(function(){n.skipWaiting()})["catch"](function(){n.skipWaiting()}))});n.addEventListener("activate",function(a){a.waitUntil(n.clients.claim())});var r,E,K=/^\/(.*)\/([gimuy]+)?$/,D=!1,C=!1;n.addEventListener("fetch",function(a){if("GET"===a.request.method){var c=!1;if(["wp-admin/",
"wp-login.php"].forEach(function(b){c||(b=new RegExp("^([^/]+)?//"+n.location.host+"(:[0-9]+)?/"+b),(b.test(a.request.url)||a.request.referrer&&b.test(a.request.referrer))&&(c=!0))}),!(c||a.request.url.match(/\&preview=true/)||a.request.url.match(/\&preview_nonce=/))&&(H(),l&&t)){var f=function(a,c){if(!c||0===c.length)return!1;if(E)try{clearTimeout(E)}catch(p){}E=setTimeout(G,500);var b=!1;if(c.forEach(function(c){if(!b&&c.match&&0!==c.match.length){var g=!0;c.match.forEach(function(b){if(g)switch(b.type){case "url":if(b.regex)(f=
y(b.pattern))?(e=f.test(a.request.url),b.not?e&&(g=!1):e||(g=!1)):g=!1;else if(b.pattern instanceof Array){var c=!1;b.pattern.forEach(function(b){c||-1!==a.request.url.indexOf(b)&&(c=!0)});b.not?c&&(g=!1):c||(g=!1)}else e=-1!==a.request.url.indexOf(b.pattern),b.not?e&&(g=!1):e||(g=!1);break;case "header":switch(b.name.toLowerCase()){case "referer":case "referrer":d=a.request.referrer;break;default:var d=a.request.headers.get(b.name)}if(d)if(b.regex){var f=y(b.pattern);f?(e=f.test(d),b.not?e&&(g=!1):
e||(g=!1)):g=!1}else{var e=-1!==d.indexOf(b.pattern);b.not?e&&(g=!1):e||(g=!1)}else b.not||(g=!1)}});g&&(b=c)}}),!b)return!1;switch(b.strategy){case "never":return!1;case "cache":return u(a.request).then(function(c){if(c){var d=!0,e=b.cache.update_interval?!isNaN(parseInt(b.cache.update_interval))&&parseInt(b.cache.update_interval):!1;if(e){var f=c.headers.get("x-abtf-sw");f&&parseInt(f)>k()-e&&(d=!1)}return d&&function(a,c){setTimeout(function(){var d;if(b.cache.head_update&&(d=function(){clients.matchAll().then(function(b){b.forEach(function(b){b.postMessage([2,
a.url])})})}),b.cache.head_update)J(a,b.cache,c,d);else{var e=q(a,b.cache);d&&e.then(d)}},10)}(a.request.clone(),c.clone()),c}return q(a.request,b.cache,function(c,d){return b.offline?B(b.offline,c.clone()):d||m(a.request.clone())["catch"](function(a){throw a;})})});case "event":return u(a.request).then(function(c){return c||q(a.request,null,function(c,d){return b.offline?B(b.offline,c.clone()):d||m(a.request)["catch"](function(a){throw a;})})});default:return q(a.request,b.cache,function(c,d){return u(c).then(function(e){return e||
(b.offline?B(b.offline,c.clone()):d||m(a.request)["catch"](function(a){throw a;}))})})}}(a,l);if(!1!==f)return a.respondWith(f)}}});n.addEventListener("message",function(a){if(a&&a.data&&a.data instanceof Array){if(1===a.data[0]){a.data[1]&&!isNaN(parseInt(a.data[1]))&&H(parseInt(a.data[1]));a.data[3]&&!isNaN(parseInt(a.data[3]))&&(z=parseInt(a.data[3]));var c="abtf:"+(a.data[2]?a.data[2]+":":"");c!==t&&(t=c);G()}if(2===a.data[0]){var f=a.ports[0]?function(b,c){a.ports[0].postMessage({error:b,status:c})}:
!1;if(a.data[1]){var b;if("string"==typeof a.data[1]||a.data[1]instanceof Request?b=[a.data[1]]:a.data[1]instanceof Array&&(b=a.data[1]),b){var e=[];b.forEach(function(a){e.push(F(a))});f&&Promise.all(e).then(function(a){var b=[];a.forEach(function(a){var c={url:a.url,status:a.status,statusText:a.statusText};a=a.headers.get("content-length");c.size=isNaN(parseInt(a))?-1:parseInt(a);b.push(c)});f(null,b)})["catch"](function(){})}else f&&f("invalid-data")}else f&&f("no-urls")}}})}(self,self.fetch,Cache);
